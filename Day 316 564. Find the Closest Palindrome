class Solution {
    public String nearestPalindromic(String n) {
        long num = Long.parseLong(n);
        int len = n.length();
        long prefix = Long.parseLong(n.substring(0, (len + 1) / 2));
        
        long[] candidates = new long[5];
        candidates[0] = build(prefix, len);
        candidates[1] = build(prefix - 1, len);
        candidates[2] = build(prefix + 1, len);
        candidates[3] = (long)Math.pow(10, len - 1) - 1;
        candidates[4] = (long)Math.pow(10, len) + 1;

        long best = -1;
        for (long cand : candidates) {
            if (cand == num) continue;
            if (best == -1 ||
                Math.abs(cand - num) < Math.abs(best - num) ||
                (Math.abs(cand - num) == Math.abs(best - num) && cand < best)) {
                best = cand;
            }
        }
        return String.valueOf(best);
    }

    private long build(long prefix, int len) {
        String s = String.valueOf(prefix);
        StringBuilder sb = new StringBuilder(s);
        for (int i = len % 2 == 0 ? s.length() - 1 : s.length() - 2; i >= 0; i--) {
            sb.append(s.charAt(i));
        }
        return Long.parseLong(sb.toString());
    }
}
